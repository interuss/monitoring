<html>
<head>
    <style>
        body {
          margin: 1em;
          color: #24292f;
          background-color: #ffffff;
          font-family: -apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji";
          font-size: 16px;
          line-height: 1.5;
          word-wrap: break-word;
        }
        table {
          border-spacing: 0;
          border-collapse: collapse;
          width: max-content;
          max-width: 100%;
          overflow: auto;
        }
        tr {
          border-top: 1px solid hsla(210,18%,87%,1);
        }
        table tr:nth-child(2n) {
          background-color: #f6f8fa;
        }
        td {
          padding: 6px 6px;
          vertical-align: top;
          border: 1px solid #d0d7de;
        }
        th {
          padding: 6px 6px;
          text-align: left;
          background-color: rgb(230, 230, 230);
          border: 1px solid #d0d7de;
          height: 40px;
          box-sizing: border-box;
        }
        a {
          background-color: transparent;
          color: #0969da;
          text-decoration: none;
        }
        h2 {
          margin-block-end: 0.1em;
        }
        .header_row {
          position: sticky;
          top: -1px;
          z-index: 100;
        }
        .sticky_cell_value {
          position: sticky;
          top: 40px;
          z-index: 0;
        }
        .pass_result {
          background-color: rgb(192, 255, 192);
        }
        .findings_result {
          background-color: rgb(255, 255, 192);
        }
        .fail_result {
          background-color: rgb(255, 192, 192);
        }
        .not_tested {
          background-color: rgb(192, 192, 192);
        }
        .has_todo {
          background-color: rgb(255, 255, 192);
        }
        .minor_note {
          font-style: italic;
          font-size: 10px;
        }
    </style>
</head>
<body>
<div>
    <h1>Timing</h1>
    <h2>Test run</h2>
    <table>
        <tr>
            <th>Test characteristic</th>
            <th>Value</th>
        </tr>
        <tr>
            <td>Test run identifier</td>
            <td>TR-{{ test_run.test_run_id[0:7] }}</td>
        </tr>
        <tr>
            <td>Start time</td>
            <td>{{ test_run.start_time }}</td>
        </tr>
        <tr>
            <td>End time</td>
            <td>{{ test_run.end_time }}</td>
        </tr>
        <tr>
            <td>Total duration</td>
            <td>{{ format_time(duration) }}</td>
        </tr>
        <tr>
            <td>Test baseline identifier</td>
            <td>TB-{{ test_run.baseline[0:7] }}</td>
        </tr>
        <tr>
            <td>Environment identifier</td>
            <td>TE-{{ test_run.environment[0:7] }}</td>
        </tr>
        <tr>
            <td>Codebase version</td>
            <td>{{ report.codebase_version }}</td>
        </tr>
        <tr>
            <td>Commit hash</td>
            <td>{{ report.commit_hash }}</td>
        </tr>
    </table>
    <div class="minor_note">Artifact generated by {{ codebase_version }}</div>
</div>
<div>
    <div>
        <h2>Breakdown by scenario type</h2>
        <table>
            <tr>
                <th>Scenario</th>
                <th>Total time</th>
                <th>Average time</th>
                <th>Query time<br>(fraction of scenario)</th>
            </tr>
            {% for row in scenario_breakdown %}
            <tr>
                <td>{{ row.scenario }}</td>
                <td>{{ format_time(row.total_time) }}</td>
                <td>{{ format_time(row.average_time) }}</td>
                <td>{{ round(row.query_fraction * 100, 1) }}%
                {% if row.query_fraction > 1 %} (concurrent queries){% endif %}
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>
    <div>
        <h2>Breakdown by query</h2>
        <table>
            <tr>
                <th rowspan="2">Query type</th>
                <th rowspan="2">Total time</th>
                <th colspan="{{ len(servers) + 1 }}">Average time</th>
            </tr>
            <tr>
                <th>Overall</th>
                {% for server in servers %}
                <th>{{ server }}</th>
                {% endfor %}
            </tr>
            {% for row in query_breakdown %}
            <tr>
                <td>{{ row.query_type }}</td>
                <td>{{ format_time(row.total_time) }}</td>
                <td>{{ format_time(row.average_time) }}</td>
                {% for server in servers %}
                <td>{% if server in row.times_per_server %}{{ format_time(sum(row.times_per_server[server]) / len(row.times_per_server[server])) }}{% endif %}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        </table>
    </div>
    <div>
        <h2>Intentional delay breakdown</h2>
        TODO
    </div>
</div>
</body>
</html>
